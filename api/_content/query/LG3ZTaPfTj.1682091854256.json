{"_path":"/posts/nginx-onion","_dir":"posts","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Доступность веб сервера в tor и создание onion домена | Nginx tor onion","description":"Как запустить веб приложение и открыть доступность через tor в доменной зоне onion.","date":"2021-09-13T00:00:00.000Z","type":"post","tags":["dev","webserver"],"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Как запустить веб приложение и открыть доступность через tor в доменной зоне onion."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.youtube.com/watch?v=1ioGn-2JaiM","rel":["nofollow"]},"children":[{"type":"text","value":"Video"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Все действия выполняются на Arch Linux, но суть везде одинакова, разница только в пакетном менеджере."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.cloudflare.com/","rel":["nofollow"]},"children":[{"type":"text","value":"www.cloudflare.com/"}]}]}]},{"type":"element","tag":"h2","props":{"id":"установка-софта"},"children":[{"type":"text","value":"Установка софта"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Локально нужен только tor или tor браузер для доступа к будущему сервису, я буду использовать chromium с прокси портом тора 9050."}]},{"type":"element","tag":"code","props":{"code":"yay -S tor chromium\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"yay"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"-S"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"tor"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"chromium"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"На сервере нужен tor и nginx."}]},{"type":"element","tag":"code","props":{"code":"yay -S tor nginx\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"yay"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"-S"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"tor"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"nginx"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"настройка-tor"},"children":[{"type":"text","value":"Настройка tor"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Отредактировать конфиг на сервере /etc/tor/torrc, раскомментировать 2 строки."}]},{"type":"element","tag":"code","props":{"code":"sudo nano /etc/tor/torrc\n\nHiddenServiceDir /var/lib/tor/hidden_service/\nHiddenServicePort 80 127.0.0.1:80\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"nano"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/etc/tor/torrc"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"HiddenServiceDir"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/var/lib/tor/hidden_service/"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"HiddenServicePort"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"80"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"127.0.0.1:"}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"80"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"генерация-onion-домена-v3"},"children":[{"type":"text","value":"Генерация onion домена v3"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Генерировать не обязательно, по умолчанию tor сам создает нужные файлы в hidden_service при рестарте, но их можно удалить и создать имя с кастомным началом в hostname. Чем длиннее имя, тем дольше генерация."}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/cathugger/mkp224o","rel":["nofollow"]},"children":[{"type":"text","value":"github.com/cathugger/mkp224o"}]}]}]},{"type":"element","tag":"code","props":{"code":"git clone https://github.com/cathugger/mkp224o\ncd mkp224o\n./autogen.sh\n./configure\nmake\n# -t 2  потоки cpu, -n кол-во имен, имя topor\n./mkp224o filter topor -t 2 -v -n 1 -d ~/hs-keys\n#\nscp -r ~/hs-keys user@123.123.123.123:~/\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"git"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"clone"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"https://github.com/cathugger/mkp224o"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"cd"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"mkp224o"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"/autogen.sh"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"/configure"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"make"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3ed8db"},"children":[{"type":"text","value":"# -t 2  потоки cpu, -n кол-во имен, имя topor"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"/mkp224o"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"filter"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"topor"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"-t"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"-v"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"-n"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"-d"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"~/hs-keys"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3ed8db"},"children":[{"type":"text","value":"#"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"scp"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"-r"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"~/hs-keys"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"user@123.123.123.123:~/"}]}]}]}]}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Рекомендую сохранить ключи и hostname."}]}]},{"type":"element","tag":"h2","props":{"id":"права-на-hidden_service"},"children":[{"type":"text","value":"Права на hidden_service"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"На сервере после переноса файлов."}]},{"type":"element","tag":"code","props":{"code":"ssh user@123.123.123.123\nsudo cp -r ~/hs-keys/*/* /var/lib/tor/hidden_service/\nsudo chmod 700 /var/lib/tor/hidden_service\nsudo chown -R tor:tor /var/lib/tor/hidden_service/\nsudo systemctl restart tor\nsudo systemctl status tor\nsudo cat /var/lib/tor/hidden_service/hostname\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"ssh"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"user@123.123.123.123"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"cp"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"-r"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"~/hs-keys/"}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/var/lib/tor/hidden_service/"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"chmod"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"700"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/var/lib/tor/hidden_service"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"chown"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"-R"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"tor:tor"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/var/lib/tor/hidden_service/"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"restart"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"tor"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"status"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"tor"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"cat"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/var/lib/tor/hidden_service/hostname"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"настройка-nginx"},"children":[{"type":"text","value":"Настройка nginx"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Важный момент, onion работает по http поэтому не нужно использовать редиректы на 443 порт https "},{"type":"element","tag":"a","props":{"href":"/posts/web-server"},"children":[{"type":"text","value":"О первоначальной настройке nginx смотри тут"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Дефолтный конфиг "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/etc/nginx/nginx.conf"}]},{"type":"text","value":", можно в секцию server добавить созданный onion домен и он будет выдавать содержимое по умолчанию из "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/usr/share/nginx/html"}]},{"type":"text","value":", в данном случае "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"index.hmtl"}]},{"type":"text","value":"."}]},{"type":"element","tag":"code","props":{"code":"# вырезка /etc/nginx/nginx.conf\nserver {\n        listen 80 default_server;\n        listen [::]:80 default_server;\n        server_name ctlos5lhe2vc3giixr.onion;\n\n        root /usr/share/nginx/html;\n        index index.htm index.html;\n...\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3ed8db"},"children":[{"type":"text","value":"# вырезка /etc/nginx/nginx.conf"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"80"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"default_server"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" [::]:80 "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"default_server"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"server_name"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"ctlos5lhe2vc3giixr.onion"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"root"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/usr/share/nginx/html"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"index"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"index.htm"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"index.html"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"..."}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Простой конфиг, Nginx выводит содержимое директории."}]},{"type":"element","tag":"code","props":{"code":"sudo nano /etc/nginx/sites-available/onion.conf\nsudo ln -s /etc/nginx/sites-available/onion.conf /etc/nginx/sites-enabled\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"nano"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/etc/nginx/sites-available/onion.conf"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"ln"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"-s"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/etc/nginx/sites-available/onion.conf"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/etc/nginx/sites-enabled"}]}]}]}]}]},{"type":"element","tag":"code","props":{"code":"server {\n  # директория со статикой сайта\n  server_name ctlos5lhe2vc3giixr.onion;\n  root /home/cretm/app/cloud.ctlos.ru;\n  listen 80;\n  listen [::]:80;\n\n  location / {\n    autoindex on;\n    try_files $uri $uri/ =404;\n  }\n}\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3ed8db"},"children":[{"type":"text","value":"# директория со статикой сайта"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"server_name"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"ctlos5lhe2vc3giixr.onion"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"root"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/home/cretm/app/cloud.ctlos.ru"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"80"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" [::]:80;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"location"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"autoindex"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"on"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"try_files"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" $uri $uri"}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"404"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Проверка и рестарт web сервера."}]},{"type":"element","tag":"code","props":{"code":"sudo nginx -t\nsudo systemctl restart nginx\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"nginx"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"-t"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"restart"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"nginx"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Конфиг с 2 доменами и ssl. С указанием Onion-Location, добавляет фиолетовый знак в тор браузере, сайт обязательно должен иметь ssl на основном домене."}]},{"type":"element","tag":"code","props":{"code":"sudo nano /etc/nginx/sites-enabled/onion.conf\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"nano"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/etc/nginx/sites-enabled/onion.conf"}]}]}]}]}]},{"type":"element","tag":"code","props":{"code":"server {\n  server_name dev.ctlos.ru;\n  server_name ctlos5lhe2vc3giixr.onion;\n  root /home/cretm/app/cloud.ctlos.ru;\n\n  listen 80;\n  listen [::]:80;\n\n  listen 443 ssl; # managed by Certbot\n  ssl_certificate /etc/letsencrypt/live/dev.ctlos.ru/fullchain.pem; # managed by Certbot\n  ssl_certificate_key /etc/letsencrypt/live/dev.ctlos.ru/privkey.pem; # managed by Certbot\n  include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\n  ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot\n\n  location / {\n    autoindex on;\n    try_files $uri $uri/ =404;\n    add_header Onion-Location \"http://ctlos5lhe2vc3giixr.onion$request_uri\" always;\n  }\n}\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"server_name"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"dev.ctlos.ru"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"server_name"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"ctlos5lhe2vc3giixr.onion"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"root"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/home/cretm/app/cloud.ctlos.ru"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"80"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" [::]:80;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"443"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"ssl"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"class":"ct-3ed8db"},"children":[{"type":"text","value":"# managed by Certbot"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"ssl_certificate"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/etc/letsencrypt/live/dev.ctlos.ru/fullchain.pem"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"class":"ct-3ed8db"},"children":[{"type":"text","value":"# managed by Certbot"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"ssl_certificate_key"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/etc/letsencrypt/live/dev.ctlos.ru/privkey.pem"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"class":"ct-3ed8db"},"children":[{"type":"text","value":"# managed by Certbot"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"include"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/etc/letsencrypt/options-ssl-nginx.conf"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"class":"ct-3ed8db"},"children":[{"type":"text","value":"# managed by Certbot"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"ssl_dhparam"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/etc/letsencrypt/ssl-dhparams.pem"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"class":"ct-3ed8db"},"children":[{"type":"text","value":"# managed by Certbot"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"location"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"autoindex"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"on"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"try_files"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" $uri $uri"}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"404"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"add_header"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"Onion-Location"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"\"http://ctlos5lhe2vc3giixr.onion"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"$request_uri"}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"always"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Реверс прокси nginx. Пример направления домена на порт 5000 на котором работает не важно какой веб сервис, в данном случае Whoogle."}]},{"type":"element","tag":"code","props":{"code":"server {\n  server_name ctlos5lhe2vc3giixr.onion;\n  # reverse proxy\n  location / {\n    proxy_pass http://localhost:5000;  # Whoogle\n    proxy_redirect off;\n    add_header Onion-Location \"http://ctlos5lhe2vc3giixr.onion$request_uri\" always;\n\n    proxy_set_header Host $http_host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_set_header Proxy \"Cloud-LB\";\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_pass_header Server;\n\n    proxy_buffering off;\n    proxy_http_version 1.1;\n    tcp_nodelay on;\n  }\n}\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"server_name"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"ctlos5lhe2vc3giixr.onion"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3ed8db"},"children":[{"type":"text","value":"# reverse proxy"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"location"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"proxy_pass"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"http://localhost:"}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"5000"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";  "}]},{"type":"element","tag":"span","props":{"class":"ct-3ed8db"},"children":[{"type":"text","value":"# Whoogle"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"proxy_redirect"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"off"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"add_header"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"Onion-Location"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"\"http://ctlos5lhe2vc3giixr.onion"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"$request_uri"}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"always"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"Host"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" $http_host;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"X-Real-IP"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" $remote_addr;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"X-Forwarded-For"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" $proxy_add_x_forwarded_for;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"X-Forwarded-Proto"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" $scheme;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"Proxy"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"\"Cloud-LB\""}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"Upgrade"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" $http_upgrade;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"proxy_pass_header"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"Server"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"proxy_buffering"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"off"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"proxy_http_version"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f07d4a"},"children":[{"type":"text","value":"1.1"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f470dc"},"children":[{"type":"text","value":"tcp_nodelay"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-689cbb"},"children":[{"type":"text","value":"on"}]},{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"  }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0fc88d"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://ctlos.github.io/donat/","rel":["nofollow"]},"children":[{"type":"text","value":"Поблагодарить меня можно тут"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Вопросы и предложения можно оставить в чате "},{"type":"element","tag":"a","props":{"href":"https://telegram.me/ctlos","rel":["nofollow"]},"children":[{"type":"text","value":"@ctlos"}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-3ed8db{color:#8B949E}\n.ct-689cbb{color:#A5D6FF}\n.ct-f07d4a{color:#79C0FF}\n.ct-0fc88d{color:#C9D1D9}\n.ct-f470dc{color:#FFA657}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"установка-софта","depth":2,"text":"Установка софта"},{"id":"настройка-tor","depth":2,"text":"Настройка tor"},{"id":"генерация-onion-домена-v3","depth":2,"text":"Генерация onion домена v3"},{"id":"права-на-hidden_service","depth":2,"text":"Права на hidden_service"},{"id":"настройка-nginx","depth":2,"text":"Настройка nginx"}]}},"_type":"markdown","_id":"content:posts:nginx-onion.md","_source":"content","_file":"posts/nginx-onion.md","_extension":"md"}