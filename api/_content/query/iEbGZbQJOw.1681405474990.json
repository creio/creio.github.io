{"_path":"/posts/tor","_dir":"posts","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Tor проксирование","description":"Задача заставить локально обрабатывать все запросы к onion, через тор, а все остальное в обычном режиме. В этом деле поможет dnsmasq, но заставить его работать я смог только с dhcpcd, не знаю возможно ли это сделать через networkmanager, не пользуюсь им. Выключаем и удаляем все сетевое, ставим dnsmasq и dhcpcd.","date":"2022-05-26T00:00:00.000Z","type":"post","tags":["network"],"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Задача заставить локально обрабатывать все запросы к onion, через тор, а все остальное в обычном режиме. В этом деле поможет dnsmasq, но заставить его работать я смог только с dhcpcd, не знаю возможно ли это сделать через networkmanager, не пользуюсь им. Выключаем и удаляем все сетевое, ставим dnsmasq и dhcpcd."}]},{"type":"element","tag":"code","props":{"code":"sudo pacman -S dnsmasq dhcpcd tor\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"pacman"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"-S"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"dnsmasq"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"dhcpcd"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"tor"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Конфиг dnsmasq."}]},{"type":"element","tag":"code","props":{"code":"# /etc/dnsmasq.conf\n\nno-resolv\nno-hosts\nport=53\nserver=127.0.0.1#9053\nlisten-address=::1,127.0.0.1\nserver=/onion/127.0.0.1#9053\nserver=/.exit/127.0.0.1#9053\nserver=8.8.8.8\nserver=8.8.4.4\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c268e1"},"children":[{"type":"text","value":"# /etc/dnsmasq.conf"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"no-resolv"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"no-hosts"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":"port"}]},{"type":"element","tag":"span","props":{"class":"ct-0dcaaa"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"53"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-0dcaaa"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"127.0.0.1#"}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"9053"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"listen-address="}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":":1,127.0.0.1"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-0dcaaa"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"/onion/127.0.0.1#"}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"9053"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-0dcaaa"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"/.exit/127.0.0.1#"}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"9053"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-0dcaaa"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"8.8.8.8"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-0dcaaa"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"8.8.4.4"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Конфиг dhcpcd."}]},{"type":"element","tag":"code","props":{"code":"# /etc/dhcpcd.conf\n\nnohook resolv.conf\nnoarp\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c268e1"},"children":[{"type":"text","value":"# /etc/dhcpcd.conf"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"nohook"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"resolv.conf"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"noarp"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Конфиг tor. tor_resolv походу не обязательно."}]},{"type":"element","tag":"code","props":{"code":"# /etc/tor/torrc\n\nVirtualAddrNetwork 10.254.0.0/16\nAutomapHostsOnResolve 1\nAutomapHostsSuffixes .exit,.onion\nTransPort 127.0.0.1:9040 NoIsolateClientAddr SessionGroup=1\nDNSPort 127.0.0.1:9053\nServerDNSResolvConfFile /etc/tor_resolv.conf\n\n# /etc/tor_resolv.conf\n\nnameserver 8.8.8.8\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c268e1"},"children":[{"type":"text","value":"# /etc/tor/torrc"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"VirtualAddrNetwork"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"10.254.0.0/"}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"16"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"AutomapHostsOnResolve"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"1"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"AutomapHostsSuffixes"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":".exit,.onion"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"TransPort"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"127.0.0.1:"}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"9040"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"NoIsolateClientAddr"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"SessionGroup="}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"1"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"DNSPort"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"127.0.0.1:"}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"9053"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"ServerDNSResolvConfFile"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"/etc/tor_resolv.conf"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c268e1"},"children":[{"type":"text","value":"# /etc/tor_resolv.conf"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"nameserver"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"8.8.8.8"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Выключам, включаем и стартуем службы."}]},{"type":"element","tag":"code","props":{"code":"sudo systemctl disable --now systemd-networkd.socket\nsudo systemctl disable --now systemd-networkd\nsudo systemctl disable --now systemd-resolved\n\nsudo systemctl enable --now dhcpcd\nsudo systemctl enable --now dnsmasq\nsudo systemctl start tor\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"disable"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"--now"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"systemd-networkd.socket"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"disable"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"--now"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"systemd-networkd"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"disable"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"--now"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"systemd-resolved"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"enable"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"--now"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"dhcpcd"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"enable"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"--now"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"dnsmasq"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"start"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"tor"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Правила перенаправления запросов onion в тор мост."}]},{"type":"element","tag":"code","props":{"code":"# ip route show default | awk '/default/ {print $5}'\n\nsudo iptables -t nat -A PREROUTING -d 10.254.0.0/16 -i enp5s0 -p tcp -j REDIRECT --to-ports 9040\nsudo iptables -t nat -A OUTPUT -d 10.254.0.0/16 -p tcp -j REDIRECT --to-ports 9040\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c268e1"},"children":[{"type":"text","value":"# ip route show default | awk '/default/ {print $5}'"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"iptables"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"-t"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"nat"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"-A"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"PREROUTING"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"-d"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"10.254.0.0/"}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"16"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"-i"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"enp5s0"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"-p"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"tcp"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"-j"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"REDIRECT"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"--to-ports"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"9040"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"iptables"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"-t"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"nat"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"-A"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"OUTPUT"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"-d"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"10.254.0.0/"}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"16"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"-p"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"tcp"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"-j"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"REDIRECT"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"--to-ports"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"9040"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Выключить запрет в firefox. В адресной строке откройте адрес about:config и выключить значение."}]},{"type":"element","tag":"code","props":{"code":"network.dns.blockDotOnion     false\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"network.dns.blockDotOnion"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":"     "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"false"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Для теста onion keybase."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://keybase5wmilwokqirssclfnsqrjdsi7jdir5wy7y7iu3tanwmtp6oid.onion","rel":["nofollow"]},"children":[{"type":"text","value":"keybase5wmilwo"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Если все нормально, то можно выгрузить правила iptables в любое удобное место, я сохраню рядом с дефолтом."}]},{"type":"element","tag":"code","props":{"code":"# /etc/iptables/iptables.rules\n\nsudo iptables-save -f /etc/iptables/iptables.rules.tor\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c268e1"},"children":[{"type":"text","value":"# /etc/iptables/iptables.rules"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"iptables-save"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"-f"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"/etc/iptables/iptables.rules.tor"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Если нужны эти правила постоянно, то просто перетрите /etc/iptables/iptables.rules, но перед этим создайте копию."}]},{"type":"element","tag":"code","props":{"code":"sudo cp /etc/iptables/iptables.rules /etc/iptables/iptables.rules.bak\nsudo iptables-save -f /etc/iptables/iptables.rules\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"cp"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"/etc/iptables/iptables.rules"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"/etc/iptables/iptables.rules.bak"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"iptables-save"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"-f"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"/etc/iptables/iptables.rules"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Считывание правил с файла."}]},{"type":"element","tag":"code","props":{"code":"sudo iptables-restore /etc/iptables/iptables.rules.bak\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"iptables-restore"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"/etc/iptables/iptables.rules.bak"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"заворачивание-всего-трафика-в-tor"},"children":[{"type":"text","value":"Заворачивание всего трафика в tor"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"В сети наткнулся на простой пайтон скрипт, немного подправил под Arch."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/creio/dots/blob/master/.bin/toriptables3.py","rel":["nofollow"]},"children":[{"type":"text","value":"toriptables3.py"}]}]},{"type":"element","tag":"code","props":{"code":"sudo toriptables3.py -l\n\n# сброс правил\nsudo toriptables3.py -f\n\n# лучше откатите через iptables\nsudo iptables-restore /etc/iptables/iptables.rules.bak\n\n# help\nsudo toriptables3.py -h\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"toriptables3.py"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"-l"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c268e1"},"children":[{"type":"text","value":"# сброс правил"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"toriptables3.py"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"-f"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c268e1"},"children":[{"type":"text","value":"# лучше откатите через iptables"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"iptables-restore"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"/etc/iptables/iptables.rules.bak"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c268e1"},"children":[{"type":"text","value":"# help"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e18295"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-88b303"},"children":[{"type":"text","value":"toriptables3.py"}]},{"type":"element","tag":"span","props":{"class":"ct-dac861"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9be8ab"},"children":[{"type":"text","value":"-h"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"ссылки"},"children":[{"type":"text","value":"Ссылки"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://gitlab.torproject.org/legacy/trac/-/wikis/doc/TransparentProxy","rel":["nofollow"]},"children":[{"type":"text","value":"TransparentProxy"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://wiki.archlinux.org/title/iptables","rel":["nofollow"]},"children":[{"type":"text","value":"iptables"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://wiki.archlinux.org/title/Dhcpcd","rel":["nofollow"]},"children":[{"type":"text","value":"Dhcpcd"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://wiki.archlinux.org/title/Tor#Using_TorDNS_for_all_DNS_queries","rel":["nofollow"]},"children":[{"type":"text","value":"Using_TorDNS_for_all_DNS_queries"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://wiki.archlinux.org/title/Dnsmasq","rel":["nofollow"]},"children":[{"type":"text","value":"Dnsmasq"}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-0dcaaa{color:#FF7B72}\n.ct-c268e1{color:#8B949E}\n.ct-9be8ab{color:#79C0FF}\n.ct-88b303{color:#A5D6FF}\n.ct-dac861{color:#C9D1D9}\n.ct-e18295{color:#FFA657}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"заворачивание-всего-трафика-в-tor","depth":2,"text":"Заворачивание всего трафика в tor"},{"id":"ссылки","depth":2,"text":"Ссылки"}]}},"_type":"markdown","_id":"content:posts:tor.md","_source":"content","_file":"posts/tor.md","_extension":"md"}