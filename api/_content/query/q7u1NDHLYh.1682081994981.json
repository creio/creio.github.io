[{"_path":"/posts/nginx-onion","_dir":"posts","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Доступность веб сервера в tor и создание onion домена | Nginx tor onion","description":"Как запустить веб приложение и открыть доступность через tor в доменной зоне onion.","date":"2021-09-13T00:00:00.000Z","type":"post","tags":["dev","webserver"],"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Как запустить веб приложение и открыть доступность через tor в доменной зоне onion."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.youtube.com/watch?v=1ioGn-2JaiM","rel":["nofollow"]},"children":[{"type":"text","value":"Video"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Все действия выполняются на Arch Linux, но суть везде одинакова, разница только в пакетном менеджере."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.cloudflare.com/","rel":["nofollow"]},"children":[{"type":"text","value":"www.cloudflare.com/"}]}]}]},{"type":"element","tag":"h2","props":{"id":"установка-софта"},"children":[{"type":"text","value":"Установка софта"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Локально нужен только tor или tor браузер для доступа к будущему сервису, я буду использовать chromium с прокси портом тора 9050."}]},{"type":"element","tag":"code","props":{"code":"yay -S tor chromium\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"yay"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"-S"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"tor"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"chromium"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"На сервере нужен tor и nginx."}]},{"type":"element","tag":"code","props":{"code":"yay -S tor nginx\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"yay"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"-S"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"tor"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"nginx"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"настройка-tor"},"children":[{"type":"text","value":"Настройка tor"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Отредактировать конфиг на сервере /etc/tor/torrc, раскомментировать 2 строки."}]},{"type":"element","tag":"code","props":{"code":"sudo nano /etc/tor/torrc\n\nHiddenServiceDir /var/lib/tor/hidden_service/\nHiddenServicePort 80 127.0.0.1:80\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"nano"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/etc/tor/torrc"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"HiddenServiceDir"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/var/lib/tor/hidden_service/"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"HiddenServicePort"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"80"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"127.0.0.1:"}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"80"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"генерация-onion-домена-v3"},"children":[{"type":"text","value":"Генерация onion домена v3"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Генерировать не обязательно, по умолчанию tor сам создает нужные файлы в hidden_service при рестарте, но их можно удалить и создать имя с кастомным началом в hostname. Чем длиннее имя, тем дольше генерация."}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/cathugger/mkp224o","rel":["nofollow"]},"children":[{"type":"text","value":"github.com/cathugger/mkp224o"}]}]}]},{"type":"element","tag":"code","props":{"code":"git clone https://github.com/cathugger/mkp224o\ncd mkp224o\n./autogen.sh\n./configure\nmake\n# -t 2  потоки cpu, -n кол-во имен, имя topor\n./mkp224o filter topor -t 2 -v -n 1 -d ~/hs-keys\n#\nscp -r ~/hs-keys user@123.123.123.123:~/\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"git"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"clone"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"https://github.com/cathugger/mkp224o"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"cd"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"mkp224o"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"/autogen.sh"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"/configure"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"make"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f42d50"},"children":[{"type":"text","value":"# -t 2  потоки cpu, -n кол-во имен, имя topor"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"/mkp224o"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"filter"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"topor"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"-t"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"-v"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"-n"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"-d"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"~/hs-keys"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f42d50"},"children":[{"type":"text","value":"#"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"scp"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"-r"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"~/hs-keys"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"user@123.123.123.123:~/"}]}]}]}]}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Рекомендую сохранить ключи и hostname."}]}]},{"type":"element","tag":"h2","props":{"id":"права-на-hidden_service"},"children":[{"type":"text","value":"Права на hidden_service"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"На сервере после переноса файлов."}]},{"type":"element","tag":"code","props":{"code":"ssh user@123.123.123.123\nsudo cp -r ~/hs-keys/*/* /var/lib/tor/hidden_service/\nsudo chmod 700 /var/lib/tor/hidden_service\nsudo chown -R tor:tor /var/lib/tor/hidden_service/\nsudo systemctl restart tor\nsudo systemctl status tor\nsudo cat /var/lib/tor/hidden_service/hostname\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"ssh"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"user@123.123.123.123"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"cp"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"-r"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"~/hs-keys/"}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/var/lib/tor/hidden_service/"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"chmod"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"700"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/var/lib/tor/hidden_service"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"chown"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"-R"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"tor:tor"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/var/lib/tor/hidden_service/"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"restart"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"tor"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"status"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"tor"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"cat"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/var/lib/tor/hidden_service/hostname"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"настройка-nginx"},"children":[{"type":"text","value":"Настройка nginx"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Важный момент, onion работает по http поэтому не нужно использовать редиректы на 443 порт https "},{"type":"element","tag":"a","props":{"href":"/posts/web-server"},"children":[{"type":"text","value":"О первоначальной настройке nginx смотри тут"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Дефолтный конфиг "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/etc/nginx/nginx.conf"}]},{"type":"text","value":", можно в секцию server добавить созданный onion домен и он будет выдавать содержимое по умолчанию из "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/usr/share/nginx/html"}]},{"type":"text","value":", в данном случае "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"index.hmtl"}]},{"type":"text","value":"."}]},{"type":"element","tag":"code","props":{"code":"# вырезка /etc/nginx/nginx.conf\nserver {\n        listen 80 default_server;\n        listen [::]:80 default_server;\n        server_name ctlos5lhe2vc3giixr.onion;\n\n        root /usr/share/nginx/html;\n        index index.htm index.html;\n...\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f42d50"},"children":[{"type":"text","value":"# вырезка /etc/nginx/nginx.conf"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"80"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"default_server"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" [::]:80 "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"default_server"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"server_name"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"ctlos5lhe2vc3giixr.onion"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"root"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/usr/share/nginx/html"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"index"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"index.htm"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"index.html"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"..."}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Простой конфиг, Nginx выводит содержимое директории."}]},{"type":"element","tag":"code","props":{"code":"sudo nano /etc/nginx/sites-available/onion.conf\nsudo ln -s /etc/nginx/sites-available/onion.conf /etc/nginx/sites-enabled\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"nano"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/etc/nginx/sites-available/onion.conf"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"ln"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"-s"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/etc/nginx/sites-available/onion.conf"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/etc/nginx/sites-enabled"}]}]}]}]}]},{"type":"element","tag":"code","props":{"code":"server {\n  # директория со статикой сайта\n  server_name ctlos5lhe2vc3giixr.onion;\n  root /home/cretm/app/cloud.ctlos.ru;\n  listen 80;\n  listen [::]:80;\n\n  location / {\n    autoindex on;\n    try_files $uri $uri/ =404;\n  }\n}\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f42d50"},"children":[{"type":"text","value":"# директория со статикой сайта"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"server_name"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"ctlos5lhe2vc3giixr.onion"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"root"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/home/cretm/app/cloud.ctlos.ru"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"80"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" [::]:80;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"location"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"autoindex"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"on"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"try_files"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" $uri $uri"}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"404"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Проверка и рестарт web сервера."}]},{"type":"element","tag":"code","props":{"code":"sudo nginx -t\nsudo systemctl restart nginx\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"nginx"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"-t"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"restart"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"nginx"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Конфиг с 2 доменами и ssl. С указанием Onion-Location, добавляет фиолетовый знак в тор браузере, сайт обязательно должен иметь ssl на основном домене."}]},{"type":"element","tag":"code","props":{"code":"sudo nano /etc/nginx/sites-enabled/onion.conf\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"nano"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/etc/nginx/sites-enabled/onion.conf"}]}]}]}]}]},{"type":"element","tag":"code","props":{"code":"server {\n  server_name dev.ctlos.ru;\n  server_name ctlos5lhe2vc3giixr.onion;\n  root /home/cretm/app/cloud.ctlos.ru;\n\n  listen 80;\n  listen [::]:80;\n\n  listen 443 ssl; # managed by Certbot\n  ssl_certificate /etc/letsencrypt/live/dev.ctlos.ru/fullchain.pem; # managed by Certbot\n  ssl_certificate_key /etc/letsencrypt/live/dev.ctlos.ru/privkey.pem; # managed by Certbot\n  include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\n  ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot\n\n  location / {\n    autoindex on;\n    try_files $uri $uri/ =404;\n    add_header Onion-Location \"http://ctlos5lhe2vc3giixr.onion$request_uri\" always;\n  }\n}\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"server_name"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"dev.ctlos.ru"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"server_name"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"ctlos5lhe2vc3giixr.onion"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"root"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/home/cretm/app/cloud.ctlos.ru"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"80"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" [::]:80;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"443"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"ssl"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"class":"ct-f42d50"},"children":[{"type":"text","value":"# managed by Certbot"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"ssl_certificate"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/etc/letsencrypt/live/dev.ctlos.ru/fullchain.pem"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"class":"ct-f42d50"},"children":[{"type":"text","value":"# managed by Certbot"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"ssl_certificate_key"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/etc/letsencrypt/live/dev.ctlos.ru/privkey.pem"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"class":"ct-f42d50"},"children":[{"type":"text","value":"# managed by Certbot"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"include"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/etc/letsencrypt/options-ssl-nginx.conf"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"class":"ct-f42d50"},"children":[{"type":"text","value":"# managed by Certbot"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"ssl_dhparam"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/etc/letsencrypt/ssl-dhparams.pem"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"class":"ct-f42d50"},"children":[{"type":"text","value":"# managed by Certbot"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"location"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"autoindex"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"on"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"try_files"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" $uri $uri"}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"404"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"add_header"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"Onion-Location"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"\"http://ctlos5lhe2vc3giixr.onion"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"$request_uri"}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"always"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Реверс прокси nginx. Пример направления домена на порт 5000 на котором работает не важно какой веб сервис, в данном случае Whoogle."}]},{"type":"element","tag":"code","props":{"code":"server {\n  server_name ctlos5lhe2vc3giixr.onion;\n  # reverse proxy\n  location / {\n    proxy_pass http://localhost:5000;  # Whoogle\n    proxy_redirect off;\n    add_header Onion-Location \"http://ctlos5lhe2vc3giixr.onion$request_uri\" always;\n\n    proxy_set_header Host $http_host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_set_header Proxy \"Cloud-LB\";\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_pass_header Server;\n\n    proxy_buffering off;\n    proxy_http_version 1.1;\n    tcp_nodelay on;\n  }\n}\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"server_name"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"ctlos5lhe2vc3giixr.onion"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f42d50"},"children":[{"type":"text","value":"# reverse proxy"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"location"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"proxy_pass"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"http://localhost:"}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"5000"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";  "}]},{"type":"element","tag":"span","props":{"class":"ct-f42d50"},"children":[{"type":"text","value":"# Whoogle"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"proxy_redirect"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"off"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"add_header"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"Onion-Location"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"\"http://ctlos5lhe2vc3giixr.onion"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"$request_uri"}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"always"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"Host"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" $http_host;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"X-Real-IP"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" $remote_addr;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"X-Forwarded-For"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" $proxy_add_x_forwarded_for;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"X-Forwarded-Proto"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" $scheme;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"Proxy"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"\"Cloud-LB\""}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"Upgrade"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" $http_upgrade;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"proxy_pass_header"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"Server"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"proxy_buffering"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"off"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"proxy_http_version"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a5370a"},"children":[{"type":"text","value":"1.1"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3faf8c"},"children":[{"type":"text","value":"tcp_nodelay"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-46df7c"},"children":[{"type":"text","value":"on"}]},{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"  }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-972ff6"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://ctlos.github.io/donat/","rel":["nofollow"]},"children":[{"type":"text","value":"Поблагодарить меня можно тут"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Вопросы и предложения можно оставить в чате "},{"type":"element","tag":"a","props":{"href":"https://telegram.me/ctlos","rel":["nofollow"]},"children":[{"type":"text","value":"@ctlos"}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-f42d50{color:#8B949E}\n.ct-46df7c{color:#A5D6FF}\n.ct-a5370a{color:#79C0FF}\n.ct-972ff6{color:#C9D1D9}\n.ct-3faf8c{color:#FFA657}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"установка-софта","depth":2,"text":"Установка софта"},{"id":"настройка-tor","depth":2,"text":"Настройка tor"},{"id":"генерация-onion-домена-v3","depth":2,"text":"Генерация onion домена v3"},{"id":"права-на-hidden_service","depth":2,"text":"Права на hidden_service"},{"id":"настройка-nginx","depth":2,"text":"Настройка nginx"}]}},"_type":"markdown","_id":"content:posts:nginx-onion.md","_source":"content","_file":"posts/nginx-onion.md","_extension":"md"},{"_path":"/posts/web-server","_dir":"posts","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Настройка и использование Nginx в Arch Linux | Docker Portainer","description":"Nginx reverse proxy, проброс локальной сети на сервер, через wireguard. Portainer — gui для docker контейнеров.","date":"2021-04-05T00:00:00.000Z","type":"post","tags":["vpn","docker","webserver"],"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Nginx reverse proxy, проброс локальной сети на сервер, через wireguard. Portainer — gui для docker контейнеров."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.youtube.com/watch?v=IFjzUpTjsC4","rel":["nofollow"]},"children":[{"type":"text","value":"Video"}]}]},{"type":"element","tag":"h2","props":{"id":"nginx-локально"},"children":[{"type":"text","value":"Nginx локально"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Для установки на Arch."}]},{"type":"element","tag":"code","props":{"code":"sudo pacman -S nginx\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"pacman"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"-S"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"nginx"}]}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://nginx.org/ru/docs/beginners_guide.html","rel":["nofollow"]},"children":[{"type":"text","value":"Nginx docs"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://wiki.archlinux.org/index.php/Nginx","rel":["nofollow"]},"children":[{"type":"text","value":"ArchWiki Nginx"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://wiki.archlinux.org/title/Certbot","rel":["nofollow"]},"children":[{"type":"text","value":"Certbot"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Глобальный конфиг, при обращении по ip, nginx будет отдавать стандартную страницу, по пути "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/usr/share/nginx/html/index.html"}]},{"type":"text","value":", некоторые настройки и импорты других конфигураций include, user - указываю юзера creio, от которого я работаю и из его директории в дальнейшем буду импортировать статичный сайт "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/media/files/github/ctlos/ctlos.github.io/_site"}]},{"type":"text","value":", который сгенерирован jekyll, точнее это не его домашняя директория, но права на нее принадлежат ему."}]},{"type":"element","tag":"code","props":{"code":"sudo nano /etc/nginx/nginx.conf\n\nuser creio users;\nworker_processes  1;\n#error_log  logs/error.log;\n#error_log  logs/error.log  notice;\n#error_log  logs/error.log  info;\n#pid        logs/nginx.pid;\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n    #access_log  logs/access.log  main;\n    types_hash_max_size 4096;\n    server_names_hash_bucket_size 128;\n    sendfile        on;\n    #tcp_nopush     on;\n    keepalive_timeout  65;\n    gzip  on;\n\n    server {\n        listen 80 default_server;\n        listen [::]:80 default_server;\n\n        root /usr/share/nginx/html;\n        index index.htm index.html;\n\n        server_tokens off;\n        autoindex off;\n    }\n\n    include sites-enabled/*;\n}\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"nano"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/etc/nginx/nginx.conf"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"user"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"creio"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"users"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"worker_processes"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-211104"},"children":[{"type":"text","value":"#error_log  logs/error.log;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-211104"},"children":[{"type":"text","value":"#error_log  logs/error.log  notice;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-211104"},"children":[{"type":"text","value":"#error_log  logs/error.log  info;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-211104"},"children":[{"type":"text","value":"#pid        logs/nginx.pid;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"events"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"worker_connections"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"1024"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"http"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"include"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"       "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"mime.types"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"default_type"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"application/octet-stream"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-211104"},"children":[{"type":"text","value":"#access_log  logs/access.log  main;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"types_hash_max_size"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"4096"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"server_names_hash_bucket_size"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"128"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sendfile"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"on"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-211104"},"children":[{"type":"text","value":"#tcp_nopush     on;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"keepalive_timeout"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"65"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"gzip"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"on"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"80"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"default_server"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" [::]:80 "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"default_server"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"root"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/usr/share/nginx/html"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"index"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"index.htm"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"index.html"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"server_tokens"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"off"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"autoindex"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"off"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"include"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"sites-enabled/"}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Создаем 2 директории в "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"available"}]},{"type":"text","value":" будем складывать все конфиги сайтов, а в "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"enabled"}]},{"type":"text","value":" будем создавать сим линки "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ln -s"}]},{"type":"text","value":" на то, что хотим включить, если нужно выключить, то просто удаляем конфиг(симлинк) из enabled. Файлы в этих директориях, как зеркала, не важно откуда мы их будем править."}]},{"type":"element","tag":"code","props":{"code":"sudo mkdir /etc/nginx/sites-{available,enabled}\nsudo nano /etc/nginx/sites-available/home.conf\nsudo ln -s /etc/nginx/sites-available/home.conf /etc/nginx/sites-enabled\n# если нужно удалить и не забудь перезапустить nginx\nsudo rm /etc/nginx/sites-enabled/home.conf\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"mkdir"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/etc/nginx/sites-{available,enabled}"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"nano"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/etc/nginx/sites-available/home.conf"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"ln"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"-s"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/etc/nginx/sites-available/home.conf"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/etc/nginx/sites-enabled"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-211104"},"children":[{"type":"text","value":"# если нужно удалить и не забудь перезапустить nginx"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"rm"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/etc/nginx/sites-enabled/home.conf"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"команды-nginx"},"children":[{"type":"text","value":"Команды nginx"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Проверить конфигурацию на валидность."}]},{"type":"element","tag":"code","props":{"code":"sudo nginx -t\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"nginx"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"-t"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Запуск сервера, рестарт, стоп, средствами systemd."}]},{"type":"element","tag":"code","props":{"code":"sudo systemctl start nginx\n\nsudo systemctl restart nginx\n\nsudo systemctl stop nginx\n\nsudo systemctl status nginx\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"start"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"nginx"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"restart"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"nginx"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"stop"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"nginx"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"status"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"nginx"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Добавить в авто старт и убрать, если нужно."}]},{"type":"element","tag":"code","props":{"code":"sudo systemctl enable nginx\n\nsudo systemctl disable nginx\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"enable"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"nginx"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"disable"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"nginx"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Просмотр логов в зависимости, что указали в access_log и error_log."}]},{"type":"element","tag":"code","props":{"code":"cat /var/log/nginx/home.access\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"cat"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/var/log/nginx/home.access"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Я использую "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"server_name домен"}]},{"type":"text","value":", но можно манипулировать портами, если нет доменного имени, или воспользоваться freedns, no-ip и подобные. В конфиге ниже нет привязки к домену, а именно к порту, можно использовать и то и другое, как вместе, так и отдельно. В данном случае в браузере мы должны обратится "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ip:port ip:4000"}]},{"type":"text","value":". Команда ip a покажет ip, обычно это 127.0.0.1(localhost), можно и так "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"localhost:4000"}]},{"type":"text","value":", "},{"type":"element","tag":"a","props":{"href":"https://www.duckdns.org/","rel":["nofollow"]},"children":[{"type":"text","value":"www.duckdns.org/"}]},{"type":"text","value":"."}]},{"type":"element","tag":"code","props":{"code":"# cat /etc/nginx/sites-available/home.conf\nserver {\n  listen 4000;\n  listen [::]:4000;\n  # server_name creio.duckdns.org;\n\n  root /media/files/github/ctlos/ctlos.github.io/_site;\n  index index.html index.htm index.php;\n\n  access_log /var/log/nginx/home.access;\n  error_log /var/log/nginx/home.error;\n\n  location / {\n      autoindex off;\n      try_files $uri $uri/ =404;\n    }\n\n    error_page 404 /404.html;\n    location = /404.html {\n        internal;\n    }\n\n    if ($request_uri = /index.html) {\n        return 301 /;\n    }\n}\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-211104"},"children":[{"type":"text","value":"# cat /etc/nginx/sites-available/home.conf"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"4000"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" [::]:4000;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-211104"},"children":[{"type":"text","value":"# server_name creio.duckdns.org;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"root"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/media/files/github/ctlos/ctlos.github.io/_site"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"index"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"index.html"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"index.htm"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"index.php"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"access_log"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/var/log/nginx/home.access"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"error_log"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/var/log/nginx/home.error"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"location"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"autoindex"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"off"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"try_files"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" $uri $uri"}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"404"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"error_page"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"404"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/404.html"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"location"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/404.html"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"internal"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-744346"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" ($request_uri = /index.html) {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-744346"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"301"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Пример запуска jekyll, по умолчанию он стартует на localhost "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"127.0.0.1"}]},{"type":"text","value":", порт 4000, но через vpn доступа к нему вы не получите, решение указать хост "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"-H 0.0.0.0"}]},{"type":"text","value":". В этом случае нам локально не нужен запущенный nginx, а сразу же настраиваем реверс на сервере. Jekyll используется для примера, тут может быть любое приложение на любом порту."}]},{"type":"element","tag":"code","props":{"code":"bundle exec jekyll serve -H 0.0.0.0\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"bundle"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"exec"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"jekyll"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"serve"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"-H"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"0.0.0.0"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Команду можно повесить в авто запуск."}]},{"type":"element","tag":"h2","props":{"id":"nginx-на-сервере"},"children":[{"type":"text","value":"Nginx на сервере"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Конфиг проброса (reverse proxy) локалки на сервер через vpn(wireguard), о его настройке я писал "},{"type":"element","tag":"a","props":{"href":"/posts/vpn"},"children":[{"type":"text","value":"тут"}]},{"type":"text","value":"."}]},{"type":"element","tag":"code","props":{"code":"curl ident.me\n\nsudo systemctl start wg-quick@wg0\n\nip a\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"curl"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"ident.me"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"start"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"wg-quick@wg0"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"ip"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"a"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Важный момент, если вы хотите иметь доступ к работающим докерам в локальной сети из вне, через vpn, находясь за nat с динамическим ip, обязательно используйте host сеть(0.0.0.0) --network host. При создании конфигурации в portainer, выбирайте сеть host для контейнера, или при ручном запуске контейнера указывайте(--network host). Просмотр сведений о сети. "},{"type":"element","tag":"a","props":{"href":"https://stackoverflow.com/q/32103885","rel":["nofollow"]},"children":[{"type":"text","value":"stackoverflow.com/q/32103885"}]},{"type":"text","value":"."}]},{"type":"element","tag":"code","props":{"code":"# iproute2\nss -tulpn\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-211104"},"children":[{"type":"text","value":"# iproute2"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"ss"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"-tulpn"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Приложение работает и теперь можно настроить реверс прокси на сервере впн к этому порту, конфиг почти такой же как и в примере выше, только убираем путь root."}]},{"type":"element","tag":"code","props":{"code":"cat /etc/nginx/sites-enabled/home.ctlos.ru.conf\n# содержимое\nserver {\n    listen 80;\n    listen [::]:80;\n    server_name creio.duckdns.org;\n\n    access_log /var/log/nginx/home.access;\n    error_log /var/log/nginx/home.error;\n\n    # reverse proxy\n    location / {\n        proxy_pass http://10.0.0.10:4000;\n        # proxy_redirect http:// $scheme://;\n        proxy_redirect off;\n        proxy_buffering off;\n        tcp_nodelay on;\n\n        proxy_http_version 1.1;\n        proxy_pass_header Server;\n        proxy_set_header Host $http_host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_set_header Proxy \"Cloud-LB\";\n        proxy_set_header Upgrade $http_upgrade;\n    }\n}\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"cat"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/etc/nginx/sites-enabled/home.ctlos.ru.conf"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-211104"},"children":[{"type":"text","value":"# содержимое"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"80"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" [::]:80;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"server_name"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"creio.duckdns.org"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"access_log"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/var/log/nginx/home.access"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"error_log"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/var/log/nginx/home.error"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-211104"},"children":[{"type":"text","value":"# reverse proxy"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"location"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"proxy_pass"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"http://10.0.0.10:"}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"4000"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-211104"},"children":[{"type":"text","value":"# proxy_redirect http:// $scheme://;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"proxy_redirect"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"off"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"proxy_buffering"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"off"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"tcp_nodelay"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"on"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"proxy_http_version"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"1.1"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"proxy_pass_header"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"Server"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"Host"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" $http_host;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"X-Real-IP"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" $remote_addr;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"X-Forwarded-For"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" $proxy_add_x_forwarded_for;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"X-Forwarded-Proto"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" $scheme;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"Proxy"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"\"Cloud-LB\""}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"Upgrade"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" $http_upgrade;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"В "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"proxy_pass http://10.0.0.10:4000;"}]},{"type":"text","value":" указываем ip wg клиента, то есть ваш локальный ip интерфейса wg, команда ip a покажет его. Рестарт nginx и посмотрим статус."}]},{"type":"element","tag":"code","props":{"code":"sudo systemctl restart nginx\n\nsudo systemctl status nginx\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"restart"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"nginx"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"status"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"nginx"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Просмотр отдачи инфы сервером в vpn сети. Должно отдавать одни и теже данные, как локально, так и на сервере."}]},{"type":"element","tag":"code","props":{"code":"curl 10.0.0.10:4000\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"curl"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"10.0.0.10:"}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"4000"}]}]}]}]}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Таким образом можно создать множество сайтов, пробросить нужные приложения в сеть из локальной сети, но обязательное условие, иметь сервер, иначе в этом мало смысла."}]}]},{"type":"element","tag":"h2","props":{"id":"docker-portainer"},"children":[{"type":"text","value":"Docker Portainer"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"В данном подходе не обязательно иметь сервер и можно забыть о vpn, а организовать все локально, без всяких доступов за nat. Поднять в докерах plex, nextcloud и многое другое, а portainer позволяет легко этим управлять."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Установка Doker, docker-compose и настройка. "},{"type":"element","tag":"a","props":{"href":"https://wiki.archlinux.org/index.php/Docker","rel":["nofollow"]},"children":[{"type":"text","value":"wiki.archlinux.org/index.php/Docker"}]},{"type":"text","value":"."}]},{"type":"element","tag":"code","props":{"code":"sudo pacman -S docker-compose\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"pacman"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"-S"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"docker-compose"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Добавляем пользователя от которого работаем(username) в группу docker."}]},{"type":"element","tag":"code","props":{"code":"sudo usermod -aG docker username\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"usermod"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"-aG"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"docker"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"username"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Возможно стоит перезагрузиться. Включаем сервис и добавляем в авто-старт, если нужно."}]},{"type":"element","tag":"code","props":{"code":"sudo systemctl start docker\n\nsudo systemctl enable docker\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"start"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"docker"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"enable"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"docker"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Portainer — веб интерфейс на 9000 порту, для управления docker контейнерами. "},{"type":"element","tag":"a","props":{"href":"https://documentation.portainer.io/v2.0/deploy/ceinstalldocker/","rel":["nofollow"]},"children":[{"type":"text","value":"documentation portainer"}]},{"type":"text","value":". Создадим диск "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"portainer_data"}]},{"type":"text","value":", как сказано в доках."}]},{"type":"element","tag":"code","props":{"code":"docker volume create portainer_data\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"docker"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"volume"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"create"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"portainer_data"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Одна из команд ниже запустит portainer, о хост сети я уже говорил выше, но можно и использовать 2 команду, только необходимо немного ковырнуть докер. В случае отказа запуска сервиса docker, попробуйте. "},{"type":"element","tag":"a","props":{"href":"https://wiki.archlinux.org/index.php/Docker#Daemon_socket","rel":["nofollow"]},"children":[{"type":"text","value":"wiki.archlinux.org"}]},{"type":"text","value":"."}]},{"type":"element","tag":"code","props":{"code":"sudo systemctl daemon-reload\nsudo rm -rf /var/run/docker.sock\nsudo systemctl restart docker\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"daemon-reload"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"rm"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"-rf"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/var/run/docker.sock"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"restart"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"docker"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Если вы изменили socket, как сказано в вики, то используйте вторую команду, контейнер будет доступен в vpn сети на 9000 порту."}]},{"type":"element","tag":"code","props":{"code":"# запуск в host сети\ndocker run -d --network host --name=portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer-ce --logo \"https://ctlos.github.io/assets/img/logo.svg\"\n\n# bridge ports, portainer-ce\ndocker run -d -p 9000:9000 --name=portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer-ce --logo \"https://ctlos.github.io/assets/img/logo.svg\"\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-211104"},"children":[{"type":"text","value":"# запуск в host сети"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"docker"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"run"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"-d"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"--network"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"host"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"--name=portainer"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"--restart=always"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"-v"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/var/run/docker.sock:/var/run/docker.sock"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"-v"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"portainer_data:/data"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"portainer/portainer-ce"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"--logo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"\"https://ctlos.github.io/assets/img/logo.svg\""}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-211104"},"children":[{"type":"text","value":"# bridge ports, portainer-ce"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"docker"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"run"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"-d"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"-p"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"9000"}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"9000"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"--name=portainer"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"--restart=always"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"-v"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"/var/run/docker.sock:/var/run/docker.sock"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"-v"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"portainer_data:/data"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"portainer/portainer-ce"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-49a4e6"},"children":[{"type":"text","value":"--logo"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"\"https://ctlos.github.io/assets/img/logo.svg\""}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"команды-docker"},"children":[{"type":"text","value":"Команды docker"}]},{"type":"element","tag":"code","props":{"code":"# список контейнеров\ndocker ps\n\n# остановка ID или Name\ndocker stop portainer\n\n# запуск ID или Name\ndocker start fc46d04d334d\n\n# удалить\ndocker rm portainer\n\n# удалить диск\ndocker volume rm portainer_data\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-211104"},"children":[{"type":"text","value":"# список контейнеров"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"docker"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"ps"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-211104"},"children":[{"type":"text","value":"# остановка ID или Name"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"docker"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"stop"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"portainer"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-211104"},"children":[{"type":"text","value":"# запуск ID или Name"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"docker"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"start"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"fc46d04d334d"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-211104"},"children":[{"type":"text","value":"# удалить"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"docker"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"rm"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"portainer"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-211104"},"children":[{"type":"text","value":"# удалить диск"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-94da53"},"children":[{"type":"text","value":"docker"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"volume"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"rm"}]},{"type":"element","tag":"span","props":{"class":"ct-765354"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-559509"},"children":[{"type":"text","value":"portainer_data"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Многое можно делать в терминале, точнее все. Рекомендую детальней изучить docker-compose, "},{"type":"element","tag":"a","props":{"href":"https://docs.docker.com/","rel":["nofollow"]},"children":[{"type":"text","value":"docs.docker.com/"}]},{"type":"text","value":"."}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-744346{color:#FF7B72}\n.ct-211104{color:#8B949E}\n.ct-49a4e6{color:#79C0FF}\n.ct-559509{color:#A5D6FF}\n.ct-765354{color:#C9D1D9}\n.ct-94da53{color:#FFA657}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"nginx-локально","depth":2,"text":"Nginx локально","children":[{"id":"команды-nginx","depth":3,"text":"Команды nginx"}]},{"id":"nginx-на-сервере","depth":2,"text":"Nginx на сервере"},{"id":"docker-portainer","depth":2,"text":"Docker Portainer","children":[{"id":"команды-docker","depth":3,"text":"Команды docker"}]}]}},"_type":"markdown","_id":"content:posts:web-server.md","_source":"content","_file":"posts/web-server.md","_extension":"md"}]