[{"_path":"/posts/firewall","_dir":"posts","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Firewall в linux | iptables | ufw","description":"Firewall — межсетевой экран. Просмотр инфы по портам, в пакете iproute2.","type":"post","date":"2021-10-23T00:00:00.000Z","tags":["firewall"],"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Firewall — межсетевой экран. Просмотр инфы по портам, в пакете iproute2."}]},{"type":"element","tag":"code","props":{"code":"ss -tulpn\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-129197"},"children":[{"type":"text","value":"ss"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc6ab0"},"children":[{"type":"text","value":"-tulpn"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Самый распространенный iptables, над ним как правило уже обертки, типо ufw. Я использую ufw, так как не нужно городить огромные команды, как это происходит в чистом iptables."}]},{"type":"element","tag":"h2","props":{"id":"ufw"},"children":[{"type":"text","value":"Ufw"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Пакет есть в любом дистрибутиве. Предварительно включаем ssh, так как может порвать связь, а по дефолту все закрыто."}]},{"type":"element","tag":"h3","props":{"id":"установка-и-включение"},"children":[{"type":"text","value":"Установка и включение"}]},{"type":"element","tag":"code","props":{"code":"sudo pacman -S ufw\n\nsudo ufw allow ssh\nsudo ufw enable\nsudo systemctl enable --now ufw.service\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-129197"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"pacman"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc6ab0"},"children":[{"type":"text","value":"-S"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"ufw"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-129197"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"ufw"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"allow"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"ssh"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-129197"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"ufw"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"enable"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-129197"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"enable"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc6ab0"},"children":[{"type":"text","value":"--now"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"ufw.service"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"использование"},"children":[{"type":"text","value":"Использование"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Присутствуют готовые правила, как ssh, а также можно указывать порты и протокол прямо 8080/tcp."}]},{"type":"element","tag":"code","props":{"code":"# справка\nsudo ufw help\n# статус\nsudo ufw status\n# перезагрузка\nsudo ufw reload\n# выключение\nsudo ufw disable\n# открыть порт/протокол\nsudo ufw allow 8000/tcp\nsudo ufw allow 8000/udp\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6cad33"},"children":[{"type":"text","value":"# справка"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-129197"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"ufw"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"help"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6cad33"},"children":[{"type":"text","value":"# статус"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-129197"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"ufw"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"status"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6cad33"},"children":[{"type":"text","value":"# перезагрузка"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-129197"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"ufw"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"reload"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6cad33"},"children":[{"type":"text","value":"# выключение"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-129197"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"ufw"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"disable"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6cad33"},"children":[{"type":"text","value":"# открыть порт/протокол"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-129197"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"ufw"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"allow"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc6ab0"},"children":[{"type":"text","value":"8000"}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"/tcp"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-129197"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"ufw"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"allow"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc6ab0"},"children":[{"type":"text","value":"8000"}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"/udp"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"ubuntu-2004"},"children":[{"type":"text","value":"Ubuntu 20.04"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"В юбунте встретил netfilter-persistent и он перебивал ufw. Соответственно выключаем его и делаем очистку flush, перезагружаем ufw."}]},{"type":"element","tag":"code","props":{"code":"# правила, до\nsudo iptables -L\n\nsudo systemctl disable --now netfilter-persistent.service\nsudo netfilter-persistent flush\n\nsudo ufw reload\nsudo systemctl restart ufw.service\nsudo systemctl status ufw.service\n\n# правила, после\nsudo iptables -L\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6cad33"},"children":[{"type":"text","value":"# правила, до"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-129197"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"iptables"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc6ab0"},"children":[{"type":"text","value":"-L"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-129197"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"disable"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc6ab0"},"children":[{"type":"text","value":"--now"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"netfilter-persistent.service"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-129197"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"netfilter-persistent"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"flush"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-129197"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"ufw"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"reload"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-129197"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"restart"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"ufw.service"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-129197"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"status"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"ufw.service"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6cad33"},"children":[{"type":"text","value":"# правила, после"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-129197"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-21815a"},"children":[{"type":"text","value":"iptables"}]},{"type":"element","tag":"span","props":{"class":"ct-909995"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc6ab0"},"children":[{"type":"text","value":"-L"}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-6cad33{color:#8B949E}\n.ct-21815a{color:#A5D6FF}\n.ct-dc6ab0{color:#79C0FF}\n.ct-909995{color:#C9D1D9}\n.ct-129197{color:#FFA657}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"ufw","depth":2,"text":"Ufw","children":[{"id":"установка-и-включение","depth":3,"text":"Установка и включение"},{"id":"использование","depth":3,"text":"Использование"},{"id":"ubuntu-2004","depth":3,"text":"Ubuntu 20.04"}]}]}},"_type":"markdown","_id":"content:posts:firewall.md","_source":"content","_file":"posts/firewall.md","_extension":"md"}]