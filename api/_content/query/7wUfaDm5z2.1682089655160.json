[{"_path":"/posts/nginx-onion","_dir":"posts","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Доступность веб сервера в tor и создание onion домена | Nginx tor onion","description":"Как запустить веб приложение и открыть доступность через tor в доменной зоне onion.","date":"2021-09-13T00:00:00.000Z","type":"post","tags":["dev","webserver"],"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Как запустить веб приложение и открыть доступность через tor в доменной зоне onion."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.youtube.com/watch?v=1ioGn-2JaiM","rel":["nofollow"]},"children":[{"type":"text","value":"Video"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Все действия выполняются на Arch Linux, но суть везде одинакова, разница только в пакетном менеджере."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.cloudflare.com/","rel":["nofollow"]},"children":[{"type":"text","value":"www.cloudflare.com/"}]}]}]},{"type":"element","tag":"h2","props":{"id":"установка-софта"},"children":[{"type":"text","value":"Установка софта"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Локально нужен только tor или tor браузер для доступа к будущему сервису, я буду использовать chromium с прокси портом тора 9050."}]},{"type":"element","tag":"code","props":{"code":"yay -S tor chromium\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"yay"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"-S"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"tor"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"chromium"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"На сервере нужен tor и nginx."}]},{"type":"element","tag":"code","props":{"code":"yay -S tor nginx\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"yay"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"-S"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"tor"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"nginx"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"настройка-tor"},"children":[{"type":"text","value":"Настройка tor"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Отредактировать конфиг на сервере /etc/tor/torrc, раскомментировать 2 строки."}]},{"type":"element","tag":"code","props":{"code":"sudo nano /etc/tor/torrc\n\nHiddenServiceDir /var/lib/tor/hidden_service/\nHiddenServicePort 80 127.0.0.1:80\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"nano"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/etc/tor/torrc"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"HiddenServiceDir"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/var/lib/tor/hidden_service/"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"HiddenServicePort"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"80"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"127.0.0.1:"}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"80"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"генерация-onion-домена-v3"},"children":[{"type":"text","value":"Генерация onion домена v3"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Генерировать не обязательно, по умолчанию tor сам создает нужные файлы в hidden_service при рестарте, но их можно удалить и создать имя с кастомным началом в hostname. Чем длиннее имя, тем дольше генерация."}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/cathugger/mkp224o","rel":["nofollow"]},"children":[{"type":"text","value":"github.com/cathugger/mkp224o"}]}]}]},{"type":"element","tag":"code","props":{"code":"git clone https://github.com/cathugger/mkp224o\ncd mkp224o\n./autogen.sh\n./configure\nmake\n# -t 2  потоки cpu, -n кол-во имен, имя topor\n./mkp224o filter topor -t 2 -v -n 1 -d ~/hs-keys\n#\nscp -r ~/hs-keys user@123.123.123.123:~/\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"git"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"clone"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"https://github.com/cathugger/mkp224o"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"cd"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"mkp224o"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"/autogen.sh"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"/configure"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"make"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d9fadc"},"children":[{"type":"text","value":"# -t 2  потоки cpu, -n кол-во имен, имя topor"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"/mkp224o"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"filter"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"topor"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"-t"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"-v"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"-n"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"-d"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"~/hs-keys"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d9fadc"},"children":[{"type":"text","value":"#"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"scp"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"-r"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"~/hs-keys"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"user@123.123.123.123:~/"}]}]}]}]}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Рекомендую сохранить ключи и hostname."}]}]},{"type":"element","tag":"h2","props":{"id":"права-на-hidden_service"},"children":[{"type":"text","value":"Права на hidden_service"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"На сервере после переноса файлов."}]},{"type":"element","tag":"code","props":{"code":"ssh user@123.123.123.123\nsudo cp -r ~/hs-keys/*/* /var/lib/tor/hidden_service/\nsudo chmod 700 /var/lib/tor/hidden_service\nsudo chown -R tor:tor /var/lib/tor/hidden_service/\nsudo systemctl restart tor\nsudo systemctl status tor\nsudo cat /var/lib/tor/hidden_service/hostname\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"ssh"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"user@123.123.123.123"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"cp"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"-r"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"~/hs-keys/"}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/var/lib/tor/hidden_service/"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"chmod"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"700"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/var/lib/tor/hidden_service"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"chown"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"-R"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"tor:tor"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/var/lib/tor/hidden_service/"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"restart"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"tor"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"status"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"tor"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"cat"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/var/lib/tor/hidden_service/hostname"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"настройка-nginx"},"children":[{"type":"text","value":"Настройка nginx"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Важный момент, onion работает по http поэтому не нужно использовать редиректы на 443 порт https "},{"type":"element","tag":"a","props":{"href":"/posts/web-server"},"children":[{"type":"text","value":"О первоначальной настройке nginx смотри тут"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Дефолтный конфиг "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/etc/nginx/nginx.conf"}]},{"type":"text","value":", можно в секцию server добавить созданный onion домен и он будет выдавать содержимое по умолчанию из "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/usr/share/nginx/html"}]},{"type":"text","value":", в данном случае "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"index.hmtl"}]},{"type":"text","value":"."}]},{"type":"element","tag":"code","props":{"code":"# вырезка /etc/nginx/nginx.conf\nserver {\n        listen 80 default_server;\n        listen [::]:80 default_server;\n        server_name ctlos5lhe2vc3giixr.onion;\n\n        root /usr/share/nginx/html;\n        index index.htm index.html;\n...\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d9fadc"},"children":[{"type":"text","value":"# вырезка /etc/nginx/nginx.conf"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"80"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"default_server"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" [::]:80 "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"default_server"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"server_name"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"ctlos5lhe2vc3giixr.onion"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"root"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/usr/share/nginx/html"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"index"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"index.htm"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"index.html"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"..."}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Простой конфиг, Nginx выводит содержимое директории."}]},{"type":"element","tag":"code","props":{"code":"sudo nano /etc/nginx/sites-available/onion.conf\nsudo ln -s /etc/nginx/sites-available/onion.conf /etc/nginx/sites-enabled\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"nano"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/etc/nginx/sites-available/onion.conf"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"ln"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"-s"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/etc/nginx/sites-available/onion.conf"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/etc/nginx/sites-enabled"}]}]}]}]}]},{"type":"element","tag":"code","props":{"code":"server {\n  # директория со статикой сайта\n  server_name ctlos5lhe2vc3giixr.onion;\n  root /home/cretm/app/cloud.ctlos.ru;\n  listen 80;\n  listen [::]:80;\n\n  location / {\n    autoindex on;\n    try_files $uri $uri/ =404;\n  }\n}\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-d9fadc"},"children":[{"type":"text","value":"# директория со статикой сайта"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"server_name"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"ctlos5lhe2vc3giixr.onion"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"root"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/home/cretm/app/cloud.ctlos.ru"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"80"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" [::]:80;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"location"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"autoindex"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"on"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"try_files"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" $uri $uri"}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"404"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Проверка и рестарт web сервера."}]},{"type":"element","tag":"code","props":{"code":"sudo nginx -t\nsudo systemctl restart nginx\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"nginx"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"-t"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"systemctl"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"restart"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"nginx"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Конфиг с 2 доменами и ssl. С указанием Onion-Location, добавляет фиолетовый знак в тор браузере, сайт обязательно должен иметь ssl на основном домене."}]},{"type":"element","tag":"code","props":{"code":"sudo nano /etc/nginx/sites-enabled/onion.conf\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"nano"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/etc/nginx/sites-enabled/onion.conf"}]}]}]}]}]},{"type":"element","tag":"code","props":{"code":"server {\n  server_name dev.ctlos.ru;\n  server_name ctlos5lhe2vc3giixr.onion;\n  root /home/cretm/app/cloud.ctlos.ru;\n\n  listen 80;\n  listen [::]:80;\n\n  listen 443 ssl; # managed by Certbot\n  ssl_certificate /etc/letsencrypt/live/dev.ctlos.ru/fullchain.pem; # managed by Certbot\n  ssl_certificate_key /etc/letsencrypt/live/dev.ctlos.ru/privkey.pem; # managed by Certbot\n  include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\n  ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot\n\n  location / {\n    autoindex on;\n    try_files $uri $uri/ =404;\n    add_header Onion-Location \"http://ctlos5lhe2vc3giixr.onion$request_uri\" always;\n  }\n}\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"server_name"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"dev.ctlos.ru"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"server_name"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"ctlos5lhe2vc3giixr.onion"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"root"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/home/cretm/app/cloud.ctlos.ru"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"80"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" [::]:80;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"443"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"ssl"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"class":"ct-d9fadc"},"children":[{"type":"text","value":"# managed by Certbot"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"ssl_certificate"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/etc/letsencrypt/live/dev.ctlos.ru/fullchain.pem"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"class":"ct-d9fadc"},"children":[{"type":"text","value":"# managed by Certbot"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"ssl_certificate_key"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/etc/letsencrypt/live/dev.ctlos.ru/privkey.pem"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"class":"ct-d9fadc"},"children":[{"type":"text","value":"# managed by Certbot"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"include"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/etc/letsencrypt/options-ssl-nginx.conf"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"class":"ct-d9fadc"},"children":[{"type":"text","value":"# managed by Certbot"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"ssl_dhparam"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/etc/letsencrypt/ssl-dhparams.pem"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"class":"ct-d9fadc"},"children":[{"type":"text","value":"# managed by Certbot"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"location"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"autoindex"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"on"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"try_files"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" $uri $uri"}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"404"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"add_header"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"Onion-Location"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"\"http://ctlos5lhe2vc3giixr.onion"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"$request_uri"}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"always"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Реверс прокси nginx. Пример направления домена на порт 5000 на котором работает не важно какой веб сервис, в данном случае Whoogle."}]},{"type":"element","tag":"code","props":{"code":"server {\n  server_name ctlos5lhe2vc3giixr.onion;\n  # reverse proxy\n  location / {\n    proxy_pass http://localhost:5000;  # Whoogle\n    proxy_redirect off;\n    add_header Onion-Location \"http://ctlos5lhe2vc3giixr.onion$request_uri\" always;\n\n    proxy_set_header Host $http_host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_set_header Proxy \"Cloud-LB\";\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_pass_header Server;\n\n    proxy_buffering off;\n    proxy_http_version 1.1;\n    tcp_nodelay on;\n  }\n}\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"server_name"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"ctlos5lhe2vc3giixr.onion"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-d9fadc"},"children":[{"type":"text","value":"# reverse proxy"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"location"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"proxy_pass"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"http://localhost:"}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"5000"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";  "}]},{"type":"element","tag":"span","props":{"class":"ct-d9fadc"},"children":[{"type":"text","value":"# Whoogle"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"proxy_redirect"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"off"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"add_header"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"Onion-Location"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"\"http://ctlos5lhe2vc3giixr.onion"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"$request_uri"}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"always"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"Host"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" $http_host;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"X-Real-IP"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" $remote_addr;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"X-Forwarded-For"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" $proxy_add_x_forwarded_for;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"X-Forwarded-Proto"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" $scheme;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"Proxy"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"\"Cloud-LB\""}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"proxy_set_header"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"Upgrade"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" $http_upgrade;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"proxy_pass_header"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"Server"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"proxy_buffering"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"off"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"proxy_http_version"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e63c54"},"children":[{"type":"text","value":"1.1"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-25ef41"},"children":[{"type":"text","value":"tcp_nodelay"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-233552"},"children":[{"type":"text","value":"on"}]},{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"  }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f6011b"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://ctlos.github.io/donat/","rel":["nofollow"]},"children":[{"type":"text","value":"Поблагодарить меня можно тут"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Вопросы и предложения можно оставить в чате "},{"type":"element","tag":"a","props":{"href":"https://telegram.me/ctlos","rel":["nofollow"]},"children":[{"type":"text","value":"@ctlos"}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-d9fadc{color:#8B949E}\n.ct-233552{color:#A5D6FF}\n.ct-e63c54{color:#79C0FF}\n.ct-f6011b{color:#C9D1D9}\n.ct-25ef41{color:#FFA657}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"установка-софта","depth":2,"text":"Установка софта"},{"id":"настройка-tor","depth":2,"text":"Настройка tor"},{"id":"генерация-onion-домена-v3","depth":2,"text":"Генерация onion домена v3"},{"id":"права-на-hidden_service","depth":2,"text":"Права на hidden_service"},{"id":"настройка-nginx","depth":2,"text":"Настройка nginx"}]}},"_type":"markdown","_id":"content:posts:nginx-onion.md","_source":"content","_file":"posts/nginx-onion.md","_extension":"md"},{"_path":"/posts/fluxbb-discourse","_dir":"posts","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Перенос форума fluxbb на discourse","description":"","date":"2021-06-19T00:00:00.000Z","type":"post","tags":["dev","fluxbb"],"body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"перенос-mysql"},"children":[{"type":"text","value":"Перенос mysql"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Для переноса нужно получить базу данных форума fluxbb, наверняка вы знаете как это сделать, но если нет, то вот. Данные для подключение к базе, которые вы создавали, или то, что предоставил хостер, при создании."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host_ip - ip или домен mysql."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"user_db - имя пользователя базы"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"PASS_WORD_DB - пароль к базе"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"db_name - имя базы"}]}]},{"type":"element","tag":"code","props":{"code":"# получение через ssh\nssh creio@125.120.10.54 \"mysqldump -h host_ip -u user_db -pPASS_WORD_DB db_name\" > ~/forum.sql\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd94cf"},"children":[{"type":"text","value":"# получение через ssh"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"ssh"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"creio@125.120.10.54"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"\"mysqldump -h host_ip -u user_db -pPASS_WORD_DB db_name\""}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a6f636"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"~/forum.sql"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"login-в-docker"},"children":[{"type":"text","value":"Login в docker"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Копируем mysql дамп базы в докер контейнер и логинемся в него."}]},{"type":"element","tag":"code","props":{"code":"docker cp ~/forum.sql app:/var/www/discourse\n\n# docker exec -it app /bin/bash --login\nsudo ./launcher enter app\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"docker"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"cp"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"~/forum.sql"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"app:/var/www/discourse"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd94cf"},"children":[{"type":"text","value":"# docker exec -it app /bin/bash --login"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"./launcher"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"enter"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"app"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Установка mysql и запуск."}]},{"type":"element","tag":"code","props":{"code":"apt install -y mariadb-server mariadb-client libmariadb-dev\nservice mysql start\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"apt"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"install"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"-y"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"mariadb-server"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"mariadb-client"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"libmariadb-dev"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"service"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"mysql"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"start"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Создаем mysql базу, в которую выгрузим старые данные."}]},{"type":"element","tag":"code","props":{"code":"mysql -u root -p mysql\nmysql> CREATE USER 'fluxbb'@'localhost' IDENTIFIED BY 'fluxbb';\nmysql> CREATE DATABASE fluxbb;\nmysql> GRANT ALL PRIVILEGES ON fluxbb.* TO 'fluxbb'@'localhost';\nmysql> FLUSH PRIVILEGES;\nmysql> exit\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"mysql"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"-u"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"root"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"-p"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"mysql"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"mysql>"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"CREATE"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"USER"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"'fluxbb'@'localhost'"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"IDENTIFIED"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"BY"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"'fluxbb'"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"mysql>"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"CREATE"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"DATABASE"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"fluxbb"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"mysql>"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"GRANT"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"ALL"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"PRIVILEGES"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"ON"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"fluxbb."}]},{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"TO"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"'fluxbb'@'localhost'"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"mysql>"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"FLUSH"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"PRIVILEGES"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"mysql>"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"exit"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Логинимся под юзера discourse."}]},{"type":"element","tag":"code","props":{"code":"su discourse\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"su"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"discourse"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Экспортируем базу данных fluxbb."}]},{"type":"element","tag":"code","props":{"code":"mysql -u fluxbb -p fluxbb < forum.sql\n# pass\nfluxbb\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"mysql"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"-u"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"fluxbb"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"-p"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"fluxbb"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a6f636"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"forum.sql"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd94cf"},"children":[{"type":"text","value":"# pass"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"fluxbb"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Добавляем зависимости в Gemfile."}]},{"type":"element","tag":"code","props":{"code":"echo \"gem 'mysql2'\" >> Gemfile\necho \"gem 'redcarpet'\" >> Gemfile\necho \"gem 'ruby-bbcode-to-md', git: 'https://github.com/nlalonde/ruby-bbcode-to-md'\" >> Gemfile\necho \"gem 'reverse_markdown'\" >> Gemfile\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"echo"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"\"gem 'mysql2'\""}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a6f636"},"children":[{"type":"text","value":">>"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"Gemfile"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"echo"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"\"gem 'redcarpet'\""}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a6f636"},"children":[{"type":"text","value":">>"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"Gemfile"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"echo"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"\"gem 'ruby-bbcode-to-md', git: 'https://github.com/nlalonde/ruby-bbcode-to-md'\""}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a6f636"},"children":[{"type":"text","value":">>"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"Gemfile"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"echo"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"\"gem 'reverse_markdown'\""}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a6f636"},"children":[{"type":"text","value":">>"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"Gemfile"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Установка зависимостей для корректной конвертации."}]},{"type":"element","tag":"code","props":{"code":"bundle config unset deployment\nbundle install --no-deployment --path vendor/bundle --jobs 4 --without test development\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"bundle"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"config"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"unset"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"deployment"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"bundle"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"install"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"--no-deployment"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"--path"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"vendor/bundle"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"--jobs"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"4"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"--without"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"test"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"development"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Данные для подключение к mysql, возможно у вас нет FLUXBB_PREFIX в базе и будет ошибка, попробуйте убрать это значение."}]},{"type":"element","tag":"code","props":{"code":"FLUXBB_HOST=\"localhost\" FLUXBB_DB=\"fluxbb\" FLUXBB_USER=\"fluxbb\" FLUXBB_PW=\"fluxbb\" FLUXBB_PREFIX=\"bb_\" bundle exec ruby script/import_scripts/fluxbb.rb\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":"FLUXBB_HOST"}]},{"type":"element","tag":"span","props":{"class":"ct-a6f636"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"\"localhost\""}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" FLUXBB_DB"}]},{"type":"element","tag":"span","props":{"class":"ct-a6f636"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"\"fluxbb\""}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" FLUXBB_USER"}]},{"type":"element","tag":"span","props":{"class":"ct-a6f636"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"\"fluxbb\""}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" FLUXBB_PW"}]},{"type":"element","tag":"span","props":{"class":"ct-a6f636"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"\"fluxbb\""}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" FLUXBB_PREFIX"}]},{"type":"element","tag":"span","props":{"class":"ct-a6f636"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"\"bb_\""}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" bundle exec ruby script/import_scripts/fluxbb.rb"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Изменение домена, полезно выполнить на тестовом домене, а когда все готово изменить на основной, "},{"type":"element","tag":"a","props":{"href":"https://meta.discourse.org/t/change-the-domain-name-or-rename-my-discourse/16098","rel":["nofollow"]},"children":[{"type":"text","value":"meta.discourse.org"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"обновление-discourse"},"children":[{"type":"text","value":"Обновление discourse"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Первым делом стоит обновить сам сервер(ubuntu/debian)."}]},{"type":"element","tag":"code","props":{"code":"apt-get update\napt-get dist-upgrade\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"apt-get"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"update"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"apt-get"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"dist-upgrade"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Включить автообновления(не обязательно) и не везде это возможно, для убунту."}]},{"type":"element","tag":"code","props":{"code":"sudo dpkg-reconfigure -plow unattended-upgrades\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"dpkg-reconfigure"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"-plow"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"unattended-upgrades"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Discourse работает в докере и используются скрипты для упрощения."}]},{"type":"element","tag":"code","props":{"code":"sudo su\ncd /var/discourse\ngit pull\n./launcher rebuild app\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"su"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"cd"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"/var/discourse"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"git"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"pull"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"/launcher"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"rebuild"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"app"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"После обновления и запусков rebuild будут плодится контейнеры и images, которые забивают диск, но не используются."}]},{"type":"element","tag":"code","props":{"code":"# размер диска\ndf -h /\n# размеры директорий\ndu -sh /var/lib/*\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd94cf"},"children":[{"type":"text","value":"# размер диска"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"df"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"-h"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"/"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd94cf"},"children":[{"type":"text","value":"# размеры директорий"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"du"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"-sh"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"/var/lib/"}]},{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"*"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Удалить не нужные образы можно через docker, или через скрипт, имейте ввиду скрипт снесет все остановленные контейнеры и удалит все неиспользуемые образы. Дело в том, что если у вас работает, что-то еще кроме discourse в докере, то лучше работать именно самим docker-ом и удалять по id(7281bf55ce46)."}]},{"type":"element","tag":"code","props":{"code":"# листинг контейнеров\ndocker ps -a\n# удаление контейнеров(CONTAINER ID)\ndocker rm 8ee579ceabf7\n\n# листинг образов\ndocker images\n# удаление образов(IMAGE ID)\ndocker rmi 7281bf55ce46\n\n# удаление всего скриптом\n./launcher cleanup\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd94cf"},"children":[{"type":"text","value":"# листинг контейнеров"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"docker"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"ps"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"-a"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd94cf"},"children":[{"type":"text","value":"# удаление контейнеров(CONTAINER ID)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"docker"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"rm"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"8ee579ceabf7"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd94cf"},"children":[{"type":"text","value":"# листинг образов"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"docker"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"images"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd94cf"},"children":[{"type":"text","value":"# удаление образов(IMAGE ID)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"docker"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"rmi"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"7281bf55ce46"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd94cf"},"children":[{"type":"text","value":"# удаление всего скриптом"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-287bda"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"/launcher"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"cleanup"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Очистка системы apt."}]},{"type":"element","tag":"code","props":{"code":"apt-get autoclean\napt-get autoremove\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"apt-get"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"autoclean"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8da70f"},"children":[{"type":"text","value":"apt-get"}]},{"type":"element","tag":"span","props":{"class":"ct-1ccf6a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e60d6a"},"children":[{"type":"text","value":"autoremove"}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-287bda{color:#79C0FF}\n.ct-a6f636{color:#FF7B72}\n.ct-e60d6a{color:#A5D6FF}\n.ct-1ccf6a{color:#C9D1D9}\n.ct-8da70f{color:#FFA657}\n.ct-cd94cf{color:#8B949E}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"перенос-mysql","depth":2,"text":"Перенос mysql"},{"id":"login-в-docker","depth":2,"text":"Login в docker"},{"id":"обновление-discourse","depth":2,"text":"Обновление discourse"}]}},"_type":"markdown","_id":"content:posts:fluxbb-discourse.md","_source":"content","_file":"posts/fluxbb-discourse.md","_extension":"md"}]